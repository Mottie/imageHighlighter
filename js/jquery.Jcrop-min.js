/**
 * Jcrop v.0.9.8 (minimized)
 * (c) 2008 Kelly Hallman and DeepLiquid.com
 * More information: http://deepliquid.com/content/Jcrop.html
 * Released under MIT License - this header must remain with code
 */

(function($){$.Jcrop=function(B,C){function o(a){return""+parseInt(a)+"px"}function P(a){a=$(a).offset();return[a.left,a.top]}function I(a){return[a.pageX-W[0],a.pageY-W[1]]}function na(a,g){return function(k){if(d.aspectRatio)switch(a){case "e":k[1]=g.y+1;break;case "w":k[1]=g.y+1;break;case "n":k[0]=g.x+1;break;case "s":k[0]=g.x+1;break}else switch(a){case "e":k[1]=g.y2;break;case "w":k[1]=g.y2;break;case "n":k[0]=g.x2;break;case "s":k[0]=g.x2;break}s.setCurrent(k);t.update()}}function oa(a){var g=
a;Y.watchKeys();return function(k){s.moveOffset([k[0]-g[0],k[1]-g[1]]);g=k;t.update()}}function ea(a){switch(a){case "n":return"sw";case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function fa(a){return function(g){if(d.disabled)return false;if(a=="move"&&!d.allowMove)return false;Q=true;var k=I(g);W=P(y);G.setCursor(a=="move"?a:a+"-resize");if(a=="move")G.activateHandlers(oa(k),Z);else{k=s.getFixed();
var m=ea(a),c=s.getCorner(ea(m));s.setPressed(s.getCorner(m));s.setCurrent(c);G.activateHandlers(na(a,k),Z)}g.stopPropagation();g.preventDefault();return false}}function aa(a){return{x:parseInt(a.x*D),y:parseInt(a.y*F),x2:parseInt(a.x2*D),y2:parseInt(a.y2*F),w:parseInt(a.w*D),h:parseInt(a.h*F)}}function Z(){var a=s.getFixed();if(a.w>d.minSelect[0]&&a.h>d.minSelect[1]){t.enableHandles();t.done()}else t.release();G.setCursor(d.allowSelect?"crosshair":"default")}function pa(a){s.setCurrent(a);t.update()}
function ga(){var a=$("<div></div>").addClass(d.baseClass+"-tracker");$.browser.msie&&a.css({opacity:0,backgroundColor:"white"});return a}function ha(a){ia([a[0]/D,a[1]/F,a[2]/D,a[3]/F])}function ia(a){s.setPressed([a[0],a[1]]);s.setCurrent([a[2],a[3]]);t.update()}function ja(a){if(typeof a!="object")a={};d=$.extend(d,a);if(typeof d.onChange!=="function")d.onChange=function(){};if(typeof d.onSelect!=="function")d.onSelect=function(){}}function ba(a){d.allowResize?a?t.enableOnly():t.enableHandles():
t.disableHandles();G.setCursor(d.allowSelect?"crosshair":"default");t.setCursor(d.allowMove?"move":"default");ca.css("backgroundColor",d.bgColor);if("setSelect"in d){ha(C.setSelect);t.done();delete d.setSelect}if("trueSize"in d){D=d.trueSize[0]/x;F=d.trueSize[1]/v}R=d.maxSize[0]||0;S=d.maxSize[1]||0;T=d.minSize[0]||0;U=d.minSize[1]||0;if("outerImage"in d){y.attr("src",d.outerImage);delete d.outerImage}t.refresh()}B=B;C=C;if(typeof B!=="object")B=$(B)[0];if(typeof C!=="object")C={};if(!("trackDocument"in
C)){C.trackDocument=$.browser.msie?false:true;if($.browser.msie&&$.browser.version.split(".")[0]=="8")C.trackDocument=true}if(!("keySupport"in C))C.keySupport=$.browser.msie?false:true;var d={trackDocument:false,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,borderOpacity:0.4,handleOpacity:0.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,
swingSpeed:3,allowSelect:true,allowMove:true,allowResize:true,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}};ja(C);var J=$(B),y=J.clone().removeAttr("id").css({position:"absolute"});y.width(J.width());y.height(J.height());J.after(y).hide();(function(a,g,k){var m=a.width(),c=a.height();if(m>g&&g>0){m=g;c=g/a.width()*a.height()}if(c>k&&k>0){c=k;m=k/a.height()*a.width()}D=a.width()/m;F=a.height()/c;a.width(m).height(c)})(y,d.boxWidth,d.boxHeight);var x=y.width(),
v=y.height(),ca=$("<div />").width(x).height(v).addClass(d.baseClass+"-holder").css({position:"relative",backgroundColor:d.bgColor}).insertAfter(J).append(y);d.addClass&&ca.addClass(d.addClass);var ka=$("<img />").attr("src",y.attr("src")).css("position","absolute").width(x).height(v),da=$("<div />").width(""+parseInt(100)+"%").height(""+parseInt(100)+"%").css({zIndex:310,position:"absolute",overflow:"hidden"}).append(ka),O=$("<div />").width(""+parseInt(100)+"%").height(""+parseInt(100)+"%").css("zIndex",
320),X=$("<div />").css({position:"absolute",zIndex:300}).insertBefore(y).append(da,O),K=d.boundary,V=ga().width(x+K*2).height(v+K*2).css({position:"absolute",top:o(-K),left:o(-K),zIndex:290}).mousedown(function(a){if(d.disabled)return false;if(!d.allowSelect)return false;Q=true;W=P(y);t.disableHandles();if("crosshair"!=la){G.setCursor("crosshair");la="crosshair"}var g=I(a);s.setPressed(g);G.activateHandlers(pa,Z);Y.watchKeys();t.update();a.stopPropagation();a.preventDefault();return false}),R,S,
T,U,D,F,W=P(y),Q,la,ma,qa,s=function(){function a(){if(!d.aspectRatio){var b=q-c,l=r-e;if(R&&Math.abs(b)>R)q=b>0?c+R:c-R;if(S&&Math.abs(l)>S)r=l>0?e+S:e-S;if(U&&Math.abs(l)<U)r=l>0?e+U:e-U;if(T&&Math.abs(b)<T)q=b>0?c+T:c-T;if(c<0){q-=c;c-=c}if(e<0){r-=e;e-=e}if(q<0){c-=q;q-=q}if(r<0){e-=r;r-=r}if(q>x){b=q-x;c-=b;q-=b}if(r>v){b=r-v;e-=b;r-=b}if(c>x){b=c-v;r-=b;e-=b}if(e>v){b=e-v;r-=b;e-=b}return m(k(c,e,q,r))}b=d.aspectRatio;l=d.minSize[0]/D;var u=d.maxSize[0]/D,A=q-c,p=r-e,n=Math.abs(A),f=Math.abs(p),
L=n/f;if(u==0)u=x*10;if(L<b){n=r;w=f*b;f=A<0?c-w:w+c;if(f<0){f=0;h=Math.abs((f-c)/b);n=p<0?e-h:h+e}else if(f>x){f=x;h=Math.abs((f-c)/b);n=p<0?e-h:h+e}}else{f=q;h=n/b;n=p<0?e-h:e+h;if(n<0){n=0;w=Math.abs((n-e)*b);f=A<0?c-w:w+c}else if(n>v){n=v;w=Math.abs(n-e)*b;f=A<0?c-w:w+c}}if(f>c){if(f-c<l)f=c+l;else if(f-c>u)f=c+u;n=n>e?e+(f-c)/b:e-(f-c)/b}else if(f<c){if(c-f<l)f=c-l;else if(c-f>u)f=c-u;n=n>e?e+(c-f)/b:e-(c-f)/b}if(f<0){c-=f;f=0}else if(f>x){c-=f-x;f=x}if(n<0){e-=n;n=0}else if(n>v){e-=n-v;n=v}return last=
m(k(c,e,f,n))}function g(b){if(b[0]<0)b[0]=0;if(b[1]<0)b[1]=0;if(b[0]>x)b[0]=x;if(b[1]>v)b[1]=v;return[b[0],b[1]]}function k(b,l,u,A){var p=b,n=u,f=l,L=A;if(u<b){p=u;n=b}if(A<l){f=A;L=l}return[Math.round(p),Math.round(f),Math.round(n),Math.round(L)]}function m(b){return{x:b[0],y:b[1],x2:b[2],y2:b[3],w:b[2]-b[0],h:b[3]-b[1]}}var c=0,e=0,q=0,r=0,M,H;return{flipCoords:k,setPressed:function(b){b=g(b);q=c=b[0];r=e=b[1]},setCurrent:function(b){b=g(b);M=b[0]-q;H=b[1]-r;q=b[0];r=b[1]},getOffset:function(){return[M,
H]},moveOffset:function(b){var l=b[0];b=b[1];if(0>c+l)l-=l+c;if(0>e+b)b-=b+e;if(v<r+b)b+=v-(r+b);if(x<q+l)l+=x-(q+l);c+=l;q+=l;e+=b;r+=b},getCorner:function(b){var l=a();switch(b){case "ne":return[l.x2,l.y];case "nw":return[l.x,l.y];case "se":return[l.x2,l.y2];case "sw":return[l.x,l.y2]}},getFixed:a}}(),t=function(){function a(j){j=$("<div />").css({position:"absolute",opacity:d.borderOpacity}).addClass(d.baseClass+"-"+j);da.append(j);return j}function g(j,z){var E=$("<div />").mousedown(fa(j)).css({cursor:j+
"-resize",position:"absolute",zIndex:z});O.append(E);return E}function k(j){var z=d.handleSize,E=f,N=z;z=z;switch(j){case "n":case "s":z=""+parseInt(100)+"%";break;case "e":case "w":N=""+parseInt(100)+"%";break}return g(j,u++).width(z).height(N).css({top:o(-E+1),left:o(-E+1)})}function m(j){for(i in j)p[j[i]]=g(j[i],u++).css({top:o(-f+1),left:o(-f+1),opacity:d.handleOpacity}).addClass(d.baseClass+"-handle")}function c(j){var z=Math.round(j.h/2-f),E=Math.round(j.w/2-f);west=-f+1;var N=j.w-f;j=j.h-
f;"e"in p&&p.e.css({top:o(z),left:o(N)})&&p.w.css({top:o(z)})&&p.s.css({top:o(j),left:o(E)})&&p.n.css({left:o(E)});"ne"in p&&p.ne.css({left:o(N)})&&p.se.css({top:o(j),left:o(N)})&&p.sw.css({top:o(j)});"b"in p&&p.b.css({top:o(j)})&&p.r.css({left:o(N)})}function e(){var j=s.getFixed();s.setPressed([j.x,j.y]);s.setCurrent([j.x2,j.y2]);q()}function q(){if(l)return r()}function r(){var j=s.getFixed(),z=j.h;X.width(j.w).height(z);z=j.x;var E=j.y;ka.css({top:o(-E),left:o(-z)});X.css({top:o(E),left:o(z)});
d.drawBorders&&A.right.css({left:o(j.w-1)})&&A.bottom.css({top:o(j.h-1)});n&&c(j);if(!l){X.show();y.css("opacity",d.bgOpacity);l=true}d.onChange(aa(j))}function M(){n=true;if(d.allowResize){c(s.getFixed());O.show();return true}}function H(){n=false;O.hide()}function b(j){(ma=j)?H():M()}var l,u=370,A={},p={},n=false,f=d.handleOffset;if(d.drawBorders)A={top:a("hline").css("top",$.browser.msie?o(-1):o(0)),bottom:a("hline"),left:a("vline"),right:a("vline")};if(d.dragEdges){p.t=k("n");p.b=k("s");p.r=k("e");
p.l=k("w")}d.sideHandles&&m(["n","s","e","w"]);d.cornerHandles&&m(["sw","nw","ne","se"]);var L=ga().mousedown(fa("move")).css({cursor:"move",position:"absolute",zIndex:360});da.append(L);H();return{updateVisible:q,update:r,release:function(){H();X.hide();y.css("opacity",1);l=false},refresh:e,setCursor:function(j){L.css("cursor",j)},enableHandles:M,enableOnly:function(){n=true},showHandles:function(){if(n){c(s.getFixed());O.show()}},disableHandles:H,animMode:b,done:function(){b(false);e()}}}(),G=function(){function a(e){k(I(e))}
function g(e){e.preventDefault();e.stopPropagation();if(Q){Q=false;m(I(e));d.onSelect(aa(s.getFixed()));V.css({zIndex:290});c&&$(document).unbind("mousemove",a).unbind("mouseup",g);k=function(){};m=function(){}}return false}var k=function(){},m=function(){},c=d.trackDocument;c||V.mousemove(a).mouseup(g).mouseout(g);y.before(V);return{activateHandlers:function(e,q){Q=true;k=e;m=q;V.css({zIndex:450});c&&$(document).mousemove(a).mouseup(g);return false},setCursor:function(e){V.css("cursor",e)}}}(),Y=
function(){function a(m,c,e){if(d.allowMove){s.moveOffset([c,e]);t.updateVisible()}m.preventDefault();m.stopPropagation()}var g=$('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(function(m){if(m.ctrlKey)return true;var c=(qa=m.shiftKey?true:false)?10:1;switch(m.keyCode){case 37:a(m,-c,0);break;case 39:a(m,c,0);break;case 38:a(m,0,-c);break;case 40:a(m,0,c);break;case 27:t.release();break;case 9:return true}return nothing(m)}).blur(function(){g.hide()}),k=$("<div />").css({position:"absolute",
overflow:"hidden"}).append(g);d.keySupport&&k.insertBefore(y);return{watchKeys:function(){if(d.keySupport){g.show();g.focus()}}}}();O.hide();ba(true);K={animateTo:function(a){var g=a[2]/D,k=a[3]/F;if(!ma){a=s.flipCoords(a[0]/D,a[1]/F,g,k);var m=s.getFixed(),c=initcr=[m.x,m.y,m.x2,m.y2],e=d.animationDelay,q=c[0],r=c[1];g=c[2];k=c[3];var M=a[0]-initcr[0],H=a[1]-initcr[1],b=a[2]-initcr[2],l=a[3]-initcr[3],u=0,A=d.swingSpeed;t.animMode(true);var p=function(){return function(){u+=(100-u)/A;c[0]=q+u/100*
M;c[1]=r+u/100*H;c[2]=g+u/100*b;c[3]=k+u/100*l;u<100?window.setTimeout(p,e):t.done();if(u>=99.8)u=100;ia(c)}}();window.setTimeout(p,e)}},setSelect:ha,setOptions:function(a){ja(a);ba()},tellSelect:function(){return aa(s.getFixed())},tellScaled:function(){return s.getFixed()},disable:function(){d.disabled=true;t.disableHandles();t.setCursor("default");G.setCursor("default")},enable:function(){d.disabled=false;ba()},cancel:function(){t.done();G.activateHandlers(null,null)},focus:Y.watchKeys,getBounds:function(){return[x*
D,v*F]},getWidgetSize:function(){return[x,v]},release:t.release,destroy:function(){ca.remove();J.show()}};J.data("Jcrop",K);return K};$.fn.Jcrop=function(B){function C(o){var P=B.useImg||o.src,I=new Image;I.onload=function(){$.Jcrop(o,B)};I.src=P}if(typeof B!=="object")B={};this.each(function(){if($(this).data("Jcrop"))if(B=="api")return $(this).data("Jcrop");else $(this).data("Jcrop").setOptions(B);else C(this)});return this}})(jQuery);

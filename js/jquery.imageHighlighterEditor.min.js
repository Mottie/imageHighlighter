/*
* imageHighlighterEditor
*
* imageHighlighter & imageHighLighterEditor are currently available for use in all personal or commercial 
* projects under both MIT and GPL licenses.
*
* <http://wowmotty.blogspot.com/2010/06/imagehighlighter-v10.html>
*
* imageHighlighterEditor
* @v1.01    - 07-06-2010 split out the editor from the main plugin & added functionality with jCrop plugin
* @v1.0     - 06-30-2010 major overhaul of code & renaming of plugin)
* @v.91beta - 09-29-2009 fixed a few bugs with edit mode)
* @v.90beta - 09-26-2009
* @author     Rob G <wowmotty@gmail.com>
*/

(function($){$.imageHighlighterEditor=function(f,h){var a=this;a.$el=$(f);a.el=f;if(a.$el.data("imageHighlighter")){a.$el.attr("unselectable","on").css("-moz-user-select","none");a.el.onselectstart=function(){return false};var e=a.$el.data("imageHighlighter"),b=a.$el.parent(),d;a.$el.data("imageHighlighterEditor",a);a.init=function(){a.options=$.extend({},$.imageHighlighterEditor.defaultOptions,h);a.options.lockMode=false;a.$el.after('<div class="imgHLInfo"></div><div class="imgHLCoords"></div>');
a.options.jcrop=$.Jcrop&&a.options.useJcrop?true:false;if(a.options.jcrop){a.$el.Jcrop({onChange:a.move,onSelect:a.move,keySupport:false});setTimeout(function(){$(".jcrop-holder").hide();a.$el.show()},100)}a.options.jcrop||a.$el.mousemove(function(c){e.options.editMode&&a.move(c)}).click(function(){a.imgHLLock()});b.dblclick(function(){a.edit();return false});a.$el.bind("highlightActive",function(c,g){e.options.editMode&&b.find(".imgHLInfo").html("Highlight coordinates for "+g.object.html()+": "+
g.object.attr("rel"))})};a.edit=function(){e.options.editMode=!e.options.editMode;b.find(".imgHLCoords, .imgHLInfo").empty();if(e.options.editMode){b.addClass("imgHLEdited").find(".imgHLDark,.imgHLLight").removeClass("imgHLOverlay").hide();if(a.options.jcrop){d='Current box coordinates : <input class="wideCoords" type="text" value="" />';b.find(".jcrop-holder").show();a.$el.hide()}else{d='Mouse x,y coordinates (click to lock/unlock) : <input class="regCoords" type="text" value="" />';a.$el.css("cursor",
"crosshair")}b.find(".imgHLCoords").html(d).find("input").focus(function(){this.select()}).mouseup(function(){return false})}else{b.removeClass("imgHLEdited imgHLLocked").find(".imgHLDark").show();if(a.options.jcrop){b.find(".jcrop-holder").hide();a.$el.show()}a.$el.css("cursor","default");a.options.lockMode=false}return false};a.move=function(c){if(!a.options.lockMode){if(a.options.jcrop)d=c.x+","+c.y+","+c.x2+","+c.y2;else{d=a.$el.position();var g=parseInt(c.pageX-d.left,10);c=parseInt(c.pageY-
d.top,10);d=Math.max(0,g)+","+Math.max(0,c)}b.find(".imgHLCoords input").val(d);return false}};a.imgHLLock=function(){if(e.options.editMode){a.options.lockMode=!a.options.lockMode;a.options.lockMode?b.addClass("imgHLLocked"):b.removeClass("imgHLLocked")}};a.init()}};$.imageHighlighterEditor.defaultOptions={useJcrop:true};$.fn.imageHighlighterEditor=function(f){return this.each(function(){new $.imageHighlighterEditor(this,f)})};$.fn.getimageHighlighterEditor=function(){return this.data("imageHighlighterEditor")}})(jQuery);
